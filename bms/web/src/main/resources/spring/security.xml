<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:oauth2="http://www.springframework.org/schema/security/oauth2"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
            http://www.springframework.org/schema/security
            http://www.springframework.org/schema/security/spring-security-3.1.xsd
            http://www.springframework.org/schema/security/oauth2
            http://www.springframework.org/schema/security/spring-security-oauth2.xsd
            ">

    <http pattern="/js/**" security="none"/>
    <http pattern="/css/**" security="none"/>
    <http pattern="/images/**" security="none"/>
    <http pattern="/index.jsp*" security="none"/>
    <http pattern="/" security="none"/>
    <http pattern="/api/**" security="none"/>
    <http pattern="/*.html" security="none"/>

    <http auto-config="false" entry-point-ref="loginUrlAuthenticationEntryPoint" access-denied-page="/403.jsp" disable-url-rewriting="true">

        <intercept-url pattern="/system/**" access="ROLE_ADMIN" />

        <custom-filter ref="usernamePasswordAuthenticationFilter" position="FORM_LOGIN_FILTER"/>
        <session-management invalid-session-url="/?action=2" />

        <logout logout-url="/logout" logout-success-url="/?action=3"/>
    </http>

    <beans:bean id="loginUrlAuthenticationEntryPoint" class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
        <beans:constructor-arg value="/"/>
    </beans:bean>

    <beans:bean id="usernamePasswordAuthenticationFilter" class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
        <beans:property name="filterProcessesUrl" value="/account_check"/>
        <beans:property name="usernameParameter" value="account"/>
        <beans:property name="passwordParameter" value="password"/>
        <beans:property name="authenticationSuccessHandler" ref="authenticationSuccessHandler"/>
        <beans:property name="authenticationFailureHandler" ref="authenticationFailureHandler"/>
        <beans:property name="authenticationManager" ref="authenticationManager"/>
    </beans:bean>

    <beans:bean id="authenticationSuccessHandler" class="org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler">
        <beans:property name="defaultTargetUrl" value="/system/billing/list"/>
    </beans:bean>
    <beans:bean id="authenticationFailureHandler" class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
        <beans:property name="defaultFailureUrl" value="/?action=1"/>
    </beans:bean>

    <authentication-manager alias="authenticationManager">
        <authentication-provider user-service-ref="userService">
            <password-encoder hash="md5"/>
        </authentication-provider>
    </authentication-manager>

    <!-- OAuth 2.0 Configuration -->

    <!--<http pattern="/oauth/**" entry-point-ref="auth2AuthenticationEntryPoint">
        <intercept-url pattern="/oauth/**" access="ROLE_AUTH2" />
        <custom-filter ref="clientCredentialsTokenEndpointFilter" position="BASIC_AUTH_FILTER"/>
    </http>

    <beans:bean id="clientCredentialsTokenEndpointFilter" class="org.springframework.security.oauth2.provider.client.ClientCredentialsTokenEndpointFilter">
        <beans:property name="authenticationManager" ref="auth2AuthenticationManager"/>
    </beans:bean>
    <beans:bean id="auth2AuthenticationEntryPoint" class="org.springframework.security.oauth2.provider.error.OAuth2AuthenticationEntryPoint"/>

    <beans:bean id="auth2AuthenticationManager" class="org.springframework.security.oauth2.provider.authentication.OAuth2AuthenticationManager">
        <beans:property name="resourceId" value="xxx"/>
        <beans:property name="tokenServices" ref="defaultTokenServices"/>
    </beans:bean>

    <beans:bean id="defaultTokenServices" class="org.springframework.security.oauth2.provider.token.DefaultTokenServices">
        &lt;!&ndash;<beans:property name="tokenStore" ref="jdbcTokenStore"/>&ndash;&gt;
        <beans:property name="tokenStore" ref="inMemoryTokenStore"/>
    </beans:bean>

    &lt;!&ndash;<beans:bean id="jdbcTokenStore" class="org.springframework.security.oauth2.provider.token.JdbcTokenStore">
        <beans:constructor-arg ref="dataSource"/>
    </beans:bean>&ndash;&gt;

    <beans:bean id="inMemoryTokenStore" class="org.springframework.security.oauth2.provider.token.InMemoryTokenStore"/>

    <oauth2:authorization-server token-services-ref="defaultTokenServices">
        <oauth2:password authentication-manager-ref="auth2AuthenticationManager"/>
    </oauth2:authorization-server>-->

</beans:beans>